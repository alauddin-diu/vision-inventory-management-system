import{P as I,aC as L,a as _,L as s,l as E,m as H,D as c,ae as K,I as j,V as F,ad as V,U as w,a8 as g,aG as q,o as C,G as v,g as A,aq as P,a3 as M,R as G,B as Y,n as $,E as S}from"./index-0d19177e.js";import{i as k,p as a,D as t,F as p}from"./BaseContext-b2603304-d1129fb6.js";import{a as y,c as Z,f as O}from"./DesktopAppView-6f26ab52-fe364a3c.js";import{M as U,j as z,C as R}from"./LanguageSelect-22d9832f-b47202f9.js";import{m as f,C as W,j as D}from"./auth-94100680-dd86dcc7.js";import{G as b}from"./use-form-5049279f-ad64b2d3.js";import{e as N}from"./IconTrash-0f9cb02d-5e67fec3.js";import"./IconEdit-d5d0707d-e9613b1d.js";var Q=k("language","IconLanguage",[["path",{d:"M4 5h7",key:"svg-0"}],["path",{d:"M9 3v2c0 4.418 -2.239 8 -5 8",key:"svg-1"}],["path",{d:"M5 9c0 2.144 2.952 3.908 6.7 4",key:"svg-2"}],["path",{d:"M12 20l4 -9l4 9",key:"svg-3"}],["path",{d:"M19.1 18h-6.2",key:"svg-4"}]]),B=k("server","IconServer",[["path",{d:"M3 4m0 3a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v2a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3z",key:"svg-0"}],["path",{d:"M3 12m0 3a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v2a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3z",key:"svg-1"}],["path",{d:"M7 8l0 .01",key:"svg-2"}],["path",{d:"M7 16l0 .01",key:"svg-3"}]]),X=k("square-plus","IconSquarePlus",[["path",{d:"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M9 12l6 0",key:"svg-1"}],["path",{d:"M12 9l0 6",key:"svg-2"}]]);function J(){const[i,r]=F();return s.jsxs(c,{position:"center",style:{border:i===!0?"1px dashed ":"",margin:i===!0?2:12,padding:i===!0?8:0},children:[s.jsx(G,{onClick:()=>r.toggle(),size:"lg",children:s.jsx(Q,{})}),i&&s.jsx(c,{children:s.jsx(R,{})})]})}function T({hostname:i,toggleHostEdit:r}){const[e]=y(n=>[n.server]);return s.jsx(E,{mx:"md",children:s.jsxs(c,{children:[s.jsx(U,{}),s.jsx(J,{}),s.jsx(K,{label:i,children:s.jsx(B,{onClick:r})}),s.jsxs(j,{c:"dimmed",children:[e.version," | ",e.apiVersion]})]})})}function ss(){const i=b({initialValues:{username:"",password:""}}),r=b({initialValues:{email:""}}),[e,n]=F(!0),o=Z();function d(){e===!0?W(i.values.username,i.values.password).then(l=>{l===!1?p.show({title:a._({id:"4GKuCs"}),message:a._({id:"tnaYa/"}),color:"red"}):(p.show({title:a._({id:"6cPKtu"}),message:a._({id:"rxWA39"}),color:"green",icon:s.jsx(f,{size:"1rem"})}),o("/home"))}):D(r.values.email).then(l=>{(l==null?void 0:l.status)==="ok"?p.show({title:a._({id:"XAIcYu"}),message:a._({id:"R2JMfc"}),color:"green",icon:s.jsx(f,{size:"1rem"}),autoClose:!1}):p.show({title:a._({id:"ccnxuA"}),message:a._({id:"tnaYa/"}),color:"red"})})}return s.jsxs(V,{radius:"md",p:"xl",withBorder:!0,children:[s.jsx(j,{size:"lg",weight:500,children:s.jsx(t,{id:"BL4vL0"})}),s.jsxs("form",{onSubmit:i.onSubmit(()=>{}),children:[e?s.jsxs(w,{children:[s.jsx(g,{required:!0,label:a._({id:"7sNhEz"}),placeholder:"reader",...i.getInputProps("username")}),s.jsx(q,{required:!0,label:a._({id:"8ZsakT"}),placeholder:a._({id:"9TO8nT"}),...i.getInputProps("password")}),s.jsx(c,{position:"apart",mt:"0",children:s.jsx(C,{component:"button",type:"button",color:"dimmed",size:"xs",onClick:()=>o("/reset-password"),children:s.jsx(t,{id:"RfwZxd"})})})]}):s.jsx(w,{children:s.jsx(g,{required:!0,label:a._({id:"O3oNi5"}),description:a._({id:"Wr5sDQ"}),placeholder:"reader@example.org",...r.getInputProps("email")})}),s.jsxs(c,{position:"apart",mt:"xl",children:[s.jsx(C,{component:"button",type:"button",color:"dimmed",size:"xs",onClick:()=>n.toggle(),children:e?s.jsx(t,{id:"7ZOmjI"}):s.jsx(t,{id:"XlWstl"})}),s.jsx(v,{type:"submit",onClick:d,children:e?s.jsx(t,{id:"sQia9P"}):s.jsx(t,{id:"F+gz9Z"})})]})]})]})}function es({data:i,saveOptions:r}){const e=b({initialValues:i});function n(d){const l=e.values;delete l[d],e.setValues(l)}const o=Object.entries(e.values).map(([d])=>s.jsx(c,{mt:"xs",children:e.values[d]!==void 0&&s.jsxs(s.Fragment,{children:[s.jsx(g,{placeholder:a._({id:"Ai2U7L"}),withAsterisk:!0,sx:{flex:1},...e.getInputProps(`${d}.host`)}),s.jsx(g,{placeholder:a._({id:"6YtxFj"}),withAsterisk:!0,sx:{flex:1},...e.getInputProps(`${d}.name`)}),s.jsx(G,{color:"red",onClick:()=>{n(d)},children:s.jsx(N,{})})]})},d));return s.jsx("form",{onSubmit:e.onSubmit(r),children:s.jsxs(Y,{sx:{maxWidth:500},mx:"auto",children:[o.length>0?s.jsxs(c,{mb:"xs",children:[s.jsx(j,{weight:500,size:"sm",sx:{flex:1},children:s.jsx(t,{id:"Ai2U7L"})}),s.jsx(j,{weight:500,size:"sm",sx:{flex:1},children:s.jsx(t,{id:"6YtxFj"})})]}):s.jsx(j,{color:"dimmed",align:"center",children:s.jsx(t,{id:"yWMzcH"})}),o,s.jsxs(c,{mt:"md",children:[s.jsxs(v,{onClick:()=>e.setFieldValue(`${$()}`,{name:"",host:""}),children:[s.jsx(X,{}),s.jsx(t,{id:"UYWLpE"})]}),s.jsx(S,{sx:{flex:1}}),s.jsx(v,{type:"submit",children:s.jsx(t,{id:"tfDRzk"})})]})]})})}function is({hostKey:i,ChangeHost:r,setHostEdit:e}){const[n,o]=L([!1,!0]),[d,l,m]=I(h=>[h.setHost,h.setHostList,h.hostList]),u=Object.keys(m).map(h=>({value:h,label:m[h].name}));function x(h){l(h),h[i]===void 0&&d("",""),o()}return s.jsxs(s.Fragment,{children:[s.jsx(A,{order:3,children:s.jsx(t,{id:"GG8+B2"})}),s.jsxs(c,{children:[s.jsxs(c,{children:[s.jsx(P,{value:i,onChange:r,data:u,disabled:n}),s.jsx(z,{setEditing:o,editing:n,disabled:n})]}),s.jsx(z,{setEditing:e,editing:!0,disabled:n,saveIcon:s.jsx(f,{})})]}),n?s.jsxs(s.Fragment,{children:[s.jsx(M,{my:"sm"}),s.jsx(j,{children:s.jsx(t,{id:"uqEJlE"})}),s.jsx(es,{data:m,saveOptions:x})]}):s.jsxs(s.Fragment,{children:[s.jsx(M,{my:"sm"}),s.jsx(ts,{hostList:m,hostKey:i})]})]})}function ts({hostList:i,hostKey:r}){const[e]=y(n=>[n.server]);return s.jsxs(j,{children:[i[r].host,s.jsx("br",{}),s.jsx(t,{id:"GUtCZC",values:{0:e.version}}),s.jsx("br",{}),s.jsx(t,{id:"4/F1y3",values:{0:e.apiVersion}}),s.jsx("br",{}),s.jsx(t,{id:"UVRlfm",values:{0:e.instance}}),s.jsx("br",{}),s.jsx(t,{id:"ed0N/H",values:{0:e.worker_pending_tasks,1:e.plugins_enabled?` (${e.active_plugins.length})`:null},components:{0:s.jsx(j,{span:!0,c:e.worker_running?"green":"red"}),1:s.jsx(j,{span:!0,c:e.plugins_enabled?"green":"red"})}})]})}function hs(){const[i,r,e]=I(x=>[x.hostKey,x.setHost,x.hostList]),[n,o]=y(x=>[x.server,x.fetchServerApiState]),d=e[i]===void 0?a._({id:"bX1aQ5"}):e[i].name,[l,m]=L([!1,!0]);function u(x){r(e[x].host,x),o()}return _.useEffect(()=>{i===""&&u(O)},[]),_.useEffect(()=>{n.server===null&&o()},[n]),s.jsx(E,{mih:"100vh",children:s.jsx(H,{w:"md",miw:400,children:l?s.jsx(is,{hostKey:i,ChangeHost:u,setHostEdit:m}):s.jsxs(s.Fragment,{children:[s.jsx(ss,{}),s.jsx(T,{hostname:d,toggleHostEdit:m})]})})})}export{hs as default};
